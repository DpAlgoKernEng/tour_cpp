# 计算器项目测试计划

## 1. 概述

本文档描述了对C语言和C++语言实现的科学计算器项目的测试计划，包括功能测试、性能测试和安全测试。

## 2. 测试目标

### 2.1 功能测试目标
- 验证计算器能够正确解析和计算各种数学表达式
- 验证科学函数的正确性
- 验证常量的正确使用
- 验证错误处理机制

### 2.2 性能测试目标
- 比较C语言版本和C++语言版本在相同计算任务下的性能表现
- 分析两个版本在不同复杂度表达式计算时的性能差异
- 识别性能瓶颈和优化空间

### 2.3 安全测试目标
- 识别两个版本中可能存在的安全漏洞
- 发现潜在的内存安全问题
- 检查错误处理机制的完整性
- 评估输入验证的有效性

## 3. 测试环境

- 操作系统：macOS/Linux
- 编译器：GCC/Clang
- 构建工具：CMake
- 分析工具：Valgrind, gprof, AddressSanitizer

## 4. 功能测试用例

### 4.1 基本算术运算
- `2 + 3 * 4` → 预期结果: 14
- `(10 - 5) / 2` → 预期结果: 2.5
- `2^3 + 4` → 预期结果: 12

### 4.2 科学函数计算
- `sin(pi/2)` → 预期结果: 1
- `log(100)` → 预期结果: 2
- `sqrt(16) + abs(-5)` → 预期结果: 9

### 4.3 复合表达式
- `sin(pi/4) + cos(pi/4)` → 预期结果: 约1.414
- `log(exp(5))` → 预期结果: 5
- `sqrt(2^2 + 3^2)` → 预期结果: 约3.606
- `(2 + 3) * (4 - 1) / (5 + 1)` → 预期结果: 2.5
- `2^(3+1) - sqrt(16) * 2` → 预期结果: 8
- `sin(pi/2) + cos(0)` → 预期结果: 2
- `exp(ln(5))` → 预期结果: 5
- `abs(-3) + sqrt(9) - 2^2` → 预期结果: 2

## 5. 性能测试用例

### 5.1 基准测试
- 简单算术运算：`2 + 3 * 4`
- 科学函数计算：`sin(pi/2)`
- 常量使用：`2 * pi`

### 5.2 压力测试
- 深度嵌套表达式：`((((((2+3)*4)-5)/6)^2)+1)`
- 大量计算任务：连续计算1000个简单表达式
- 长表达式：超过100个字符的表达式
- 深度嵌套表达式：超过6层括号的表达式
- 大量计算任务：连续计算5000个简单表达式

## 6. 安全测试用例

### 6.1 内存安全测试
- 超长表达式输入（超过256字符）
- 连续计算大量表达式后检查内存使用
- 空表达式输入
- 深度嵌套表达式（超过6层括号）
- 大量简单计算任务（5000次以上）

### 6.2 输入验证测试
- 包含特殊符号的表达式：`2 @ 3`
- 不匹配的括号：`(2 + 3`
- 连续操作符：`2 + + 3`

### 6.3 错误处理测试
- 除零错误：`5 / 0`
- 负数开方：`sqrt(-1)`
- 对数负数：`log(-1)`
- 超长表达式：超过1000个字符的表达式
- 特殊字符：包含$、;等特殊字符的表达式
- 命令注入：尝试执行系统命令的表达式

## 7. 测试工具

### 7.1 功能测试工具
- 自定义测试脚本
- Shell脚本自动化测试

### 7.2 性能测试工具
- `time`命令
- `clock()`函数
- `std::chrono`库
- gprof (GNU profiler)
- perf (Linux)

### 7.3 安全测试工具
- Valgrind (Memcheck, Massif)
- AddressSanitizer
- Cppcheck
- Clang Static Analyzer

## 8. 测试执行步骤

### 8.1 构建项目
1. 创建构建目录
2. 运行CMake配置
3. 编译项目

### 8.2 功能测试执行
1. 运行预定义的测试用例
2. 验证输出结果
3. 记录测试结果

### 8.3 性能测试执行
1. 使用time命令测量执行时间
2. 使用性能分析工具分析热点函数
3. 记录性能数据

### 8.4 安全测试执行
1. 使用Valgrind检测内存错误
2. 使用静态分析工具检查代码
3. 记录安全问题

## 9. 测试脚本设计

### 9.1 功能测试脚本
需要创建以下脚本来自动化功能测试：
1. `functional_test.sh` - 主要的功能测试脚本

### 9.2 性能测试脚本
需要创建以下脚本来自动化性能测试：
1. `performance_test.sh` - 性能基准测试脚本
2. `stress_test.sh` - 压力测试脚本
3. `memory_test.sh` - 内存使用分析脚本

### 9.3 安全测试脚本
需要创建以下脚本来自动化安全测试：
1. `security_test.sh` - 安全漏洞扫描脚本
2. `valgrind_test.sh` - Valgrind内存检查脚本

### 9.4 共享测试工具
为了减少代码重复，创建了以下共享工具脚本：
1. `common/test_utils.sh` - 包含所有测试脚本共享的函数和变量

## 10. 测试脚本使用说明

### 10.1 一键测试脚本
`run_all_tests.sh` 是主要的一键测试脚本，支持以下参数：
- 无参数：运行所有测试
- `--functional-only`：仅运行功能测试
- `--performance-only`：仅运行性能测试
- `--security-only`：仅运行安全测试
- `--no-functional`：跳过功能测试
- `--no-performance`：跳过性能测试
- `--no-security`：跳过安全测试

### 10.2 单独运行测试脚本
每个测试脚本都可以单独运行：
- `functional_test.sh`：功能测试
- `performance_test.sh`：性能测试
- `security_test.sh`：安全测试

## 11. 测试报告

### 11.1 功能测试报告
- 测试用例通过率
- 失败用例详情
- 功能正确性分析

### 11.2 性能测试报告
- 执行时间对比
- 内存使用对比
- CPU使用率对比
- 性能瓶颈分析

### 11.3 安全测试报告
- 发现的安全问题
- 漏洞风险评估
- 修复建议

## 12. 附录

### 12.1 测试脚本
- 功能测试脚本
- 性能测试脚本
- 安全测试脚本

### 12.2 测试数据
- 详细的测试用例
- 测试结果数据